
### 1. Добавление шагов (steps) к автотестам

#### Зачем нужны шаги в автотестах?

**Проблема:** Сгенерированные автотесты часто представляют собой последовательность действий без четкой структуры. Когда тест падает, сложно понять на каком именно этапе произошла ошибка.

**Решение:** Использование `test.step()` для структурирования тестов.

#### Преимущества использования шагов:

1. **Читаемость** - тест становится понятным даже без знания кода
2. **Отладка** - легко определить на каком шаге произошла ошибка
3. **Отчетность** - в отчетах видно прогресс выполнения каждого шага
4. **Документация** - шаги служат живой документацией тест-кейса

#### Пример структурирования:

**Было:**
```typescript
test("Сгенерированый тест", async ({ page }) => {
  await page.goto("https://lavka.yandex.ru/");
  await page.getByRole("button", { name: "Закрыть модальное окно" }).click();
  await page.getByRole("searchbox", { name: "Поиск" }).fill("ВОДА");
  // ... остальные действия
});
```

**Стало:**
```typescript
test("Поиск и переход к товару через поисковую строку", async ({ page }) => {
  await test.step("Открываем главную страницу Яндекс Лавки", async () => {
    await page.goto("https://lavka.yandex.ru/");
  });
  
  await test.step("Проверяем, что страница загрузилась корректно", async () => {
    await expect(page).toHaveURL(/lavka\.yandex\.ru/);
  });
  
  await test.step("Закрываем модальное окно", async () => {
    await page.getByRole("button", { name: "Закрыть модальное окно" }).click();
  });
  // ... остальные шаги
});
```

### 2. Разделение действий и проверок

#### Принципы структурирования:

- **Действие + Проверка** - каждый шаг должен содержать действие и его проверку
- **Логическая группировка** - объединяем связанные действия и проверки в один шаг
- **Описательные названия** - название шага должно четко описывать что происходит

#### Пример:
```typescript
await test.step("Вводим поисковый запрос и проверяем его ввод", async () => {
  await page.getByRole("searchbox", { name: "Поиск" }).fill("ВОДА");
  await expect(page.getByRole("searchbox", { name: "Поиск" })).toHaveValue("ВОДА");
});
```

### 3. Визуальные проверки с помощью скриншотов

#### Что такое визуальное тестирование?

Визуальное тестирование - это проверка того, как выглядят элементы интерфейса, путем сравнения текущих скриншотов с эталонными.

#### Как работает `toHaveScreenshot()`:

1. **Первый запуск** - Playwright создает эталонный скриншот и сохраняет его
2. **Последующие запуски** - сравнивает текущий скриншот с эталонным
3. **При различиях** - тест падает и показывает diff между изображениями
4. **Обновление эталонов** - можно обновить командой `--update-snapshots`

#### Пример использования:
```typescript
await test.step("Проверяем визуальное отображение товара в результатах поиска", async () => {
  await expect(page.locator('[data-type="product-card-link"]').first()).toBeVisible();
  await expect(page.locator('[data-type="product-card-link"]').first()).toHaveScreenshot('product-card.png');
});
```

#### Преимущества визуальных проверок:

- **Обнаружение визуальных регрессий** - изменения в CSS, шрифтах, цветах
- **Кроссбраузерное тестирование** - проверка одинакового отображения в разных браузерах
- **Автоматизация UI-проверок** - не нужно вручную проверять внешний вид

#### Где хранятся скриншоты:

- Эталонные скриншоты: `tests/example.spec.ts-snapshots/`
- Результаты сравнения: `test-results/` (при падении тестов)

### 4. Практические пример

#### Тест функциональности поиска:
- Проверка работы поискового окна
- Динамическое появление/исчезновение результатов
- Проверка состояния плейсхолдера
- Проверка URL при очистке поиска

## Домашнее задание

### Задание 1: Структурирование существующего теста
Возьмите любой сгенерированный автотест и:
1. Добавьте к нему осмысленное название
2. Разбейте на логические шаги с помощью `test.step()`
3. Добавьте проверки к каждому действию
4. Убедитесь, что каждый шаг имеет описательное название

### Задание 2: Создание теста с визуальными проверками
Создайте новый тест, который:
1. Открывает главную страницу любого сайта
2. Делает скриншот главной страницы
3. Выполняет какое-то действие (например, открывает меню)
4. Делает скриншот измененного состояния
5. Возвращает страницу в исходное состояние
6. Проверяет, что визуально страница вернулась к исходному виду


### Дополнительное задание (по желанию):
Изучите документацию Playwright по визуальному тестированию и попробуйте:
- Настроить порог чувствительности для сравнения скриншотов
- Сделать скриншот только части страницы
- Использовать маски для игнорирования динамических элементов

## Полезные команды

```bash
# Запуск тестов
npx playwright test

# Запуск с обновлением скриншотов
npx playwright test --update-snapshots

# Запуск в режиме отладки
npx playwright test --debug

# Просмотр отчета
npx playwright show-report
```

