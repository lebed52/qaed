import { test, expect } from "@playwright/test";
import { QASandboxPage } from "../pages/QASandboxPage";

/**
 * üéØ –ú–û–ô –ü–ï–†–í–´–ô –ê–í–¢–û–¢–ï–°–¢ –ù–ê PLAYWRIGHT + TYPESCRIPT
 *
 * –¢–µ—Å—Ç–∏—Ä—É–µ–º QA Sandbox (https://testingit.ru/)
 * –ü–µ—Å–æ—á–Ω–∏—Ü–∞ –¥–ª—è –ø—Ä–∞–∫—Ç–∏–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
 *
 * –ß—Ç–æ —Ç—É—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:
 * 1. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ Playwright
 * 2. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º Page Object –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü–µ–π
 * 3. –û–ø–∏—Å—ã–≤–∞–µ–º –≥—Ä—É–ø–ø—É —Ç–µ—Å—Ç–æ–≤ (test suite)
 * 4. –ü–∏—à–µ–º –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ç–µ—Å—Ç-–∫–µ–π—Å—ã
 */

test.describe("üé≠ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ QA Sandbox - –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞", () => {
  /**
   * TEST #1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
   *
   * –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º:
   * - –°—Ç—Ä–∞–Ω–∏—Ü–∞ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è
   * - –ó–∞–≥–æ–ª–æ–≤–æ–∫ –≤–∏–¥–µ–Ω
   * - URL –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π
   */
  test("–û—Ç–∫—Ä—ã—Ç–∏–µ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã QA Sandbox", async ({ page }) => {
    // { page } - —ç—Ç–æ fixture –æ—Ç Playwright, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –±—Ä–∞—É–∑–µ—Ä–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç

    console.log("üöÄ –ù–∞—á–∏–Ω–∞—é —Ç–µ—Å—Ç: –û—Ç–∫—Ä—ã—Ç–∏–µ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã");

    // –°–æ–∑–¥–∞—ë–º —ç–∫–∑–µ–º–ø–ª—è—Ä Page Object
    const sandboxPage = new QASandboxPage(page);

    // –®–∞–≥ 1: –û—Ç–∫—Ä—ã–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç baseURL –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞)
    console.log("üìñ –®–∞–≥ 1: –û—Ç–∫—Ä—ã–≤–∞—é —Å—Ç—Ä–∞–Ω–∏—Ü—É https://testingit.ru/");
    await sandboxPage.goto();

    // –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∑–∏–ª–∞—Å—å
    console.log("‚úÖ –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä—è—é –∑–∞–≥—Ä—É–∑–∫—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã");
    const isLoaded = await sandboxPage.isLoaded();
    expect(isLoaded).toBe(true);

    // –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä—è–µ–º URL
    console.log("üîó –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä—è—é URL");
    expect(page.url()).toContain("testingit.ru");

    // –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä—è–µ–º title —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    console.log("üìå –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä—è—é –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã");
    await expect(page).toHaveTitle(/QA Sandbox|–ü–µ—Å–æ—á–Ω–∏—Ü–∞|testingit/i);

    // –®–∞–≥ 5: –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—Å—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∞
    const headingText = await sandboxPage.getHeadingText();
    console.log(`üìù –ó–∞–≥–æ–ª–æ–≤–æ–∫ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ: "${headingText}"`);
    expect(headingText.length).toBeGreaterThan(0);

    console.log("‚úÖ –¢–ï–° –ü–†–û–ô–î–ï–ù: –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!");
  });

  /**
   * TEST #2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –ø–æ —Ä–∞–∑–¥–µ–ª–∞–º
   *
   * –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º:
   * - –í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —Ä–∞–∑–¥–µ–ª—ã –¥–æ—Å—Ç—É–ø–Ω—ã
   * - –°—Å—ã–ª–∫–∏ –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã
   */
  test("–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Ä–∞–∑–¥–µ–ª–æ–≤ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ", async ({
    page,
  }) => {
    const sandboxPage = new QASandboxPage(page);

    console.log("üöÄ –ù–∞—á–∏–Ω–∞—é —Ç–µ—Å—Ç: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–¥–µ–ª–æ–≤");

    await sandboxPage.goto();

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å —Å—Å—ã–ª–æ–∫ –Ω–∞ —Ä–∞–∑–¥–µ–ª—ã
    console.log("üîç –ü—Ä–æ–≤–µ—Ä—è—é –≤–∏–¥–∏–º–æ—Å—Ç—å —Å—Å—ã–ª–æ–∫ –Ω–∞ —Ä–∞–∑–¥–µ–ª—ã...");

    // –§–æ—Ä–º—ã
    await expect(sandboxPage.formsLink).toBeVisible();
    console.log('  ‚úÖ –†–∞–∑–¥–µ–ª "–§–æ—Ä–º—ã –∏ Inputs" - –¥–æ—Å—Ç—É–ø–µ–Ω');

    // –¢–∞–±–ª–∏—Ü—ã
    await expect(sandboxPage.tablesLink).toBeVisible();
    console.log('  ‚úÖ –†–∞–∑–¥–µ–ª "–¢–∞–±–ª–∏—Ü—ã" - –¥–æ—Å—Ç—É–ø–µ–Ω');

    // –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞
    await expect(sandboxPage.modalsLink).toBeVisible();
    console.log('  ‚úÖ –†–∞–∑–¥–µ–ª "–ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞" - –¥–æ—Å—Ç—É–ø–µ–Ω');

    // Alerts
    await expect(sandboxPage.alertsLink).toBeVisible();
    console.log('  ‚úÖ –†–∞–∑–¥–µ–ª "Alerts & Dialogs" - –¥–æ—Å—Ç—É–ø–µ–Ω');

    // –î–µ–ª–∞–µ–º —Å–∫—Ä–∏–Ω—à–æ—Ç –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    await page.screenshot({
      path: "test-results/qa-sandbox-main-page.png",
      fullPage: true,
    });
    console.log("üì∏ –°–∫—Ä–∏–Ω—à–æ—Ç –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å–æ—Ö—Ä–∞–Ω—ë–Ω");

    console.log("‚úÖ –¢–ï–°–¢ –ü–†–û–ô–î–ï–ù: –í—Å–µ —Ä–∞–∑–¥–µ–ª—ã –¥–æ—Å—Ç—É–ø–Ω—ã!");
  });

  /**
   * TEST #3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–∞ –≤ —Ä–∞–∑–¥–µ–ª "Alerts"
   *
   * –î–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –ø–µ—Ä–µ—Ö–æ–¥ –º–µ–∂–¥—É —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏
   */
  test("–ü–µ—Ä–µ—Ö–æ–¥ –≤ —Ä–∞–∑–¥–µ–ª Alerts & Dialogs", async ({ page }) => {
    const sandboxPage = new QASandboxPage(page);

    console.log("üöÄ –ù–∞—á–∏–Ω–∞—é —Ç–µ—Å—Ç: –ü–µ—Ä–µ—Ö–æ–¥ –≤ —Ä–∞–∑–¥–µ–ª Alerts");

    // –û—Ç–∫—Ä—ã–≤–∞–µ–º –≥–ª–∞–≤–Ω—É—é
    await sandboxPage.goto();
    console.log("üìñ –û—Ç–∫—Ä—ã—Ç–∞ –≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞");

    // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ —Ä–∞–∑–¥–µ–ª Alerts
    console.log('üîÑ –ü–µ—Ä–µ—Ö–æ–∂—É –≤ —Ä–∞–∑–¥–µ–ª "Alerts & Dialogs"');
    await sandboxPage.goToAlerts();

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ URL –∏–∑–º–µ–Ω–∏–ª—Å—è
    expect(page.url()).toContain("alerts");
    console.log(`üîó URL –∏–∑–º–µ–Ω–∏–ª—Å—è: ${page.url()}`);

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –µ—Å—Ç—å –∫–Ω–æ–ø–∫–∏ –¥–ª—è –≤—ã–∑–æ–≤–∞ –¥–∏–∞–ª–æ–≥–æ–≤
    const alertButton = page.getByRole("button", { name: /alert/i }).first();
    await expect(alertButton).toBeVisible();
    console.log("‚úÖ –ö–Ω–æ–ø–∫–∞ Alert –Ω–∞–π–¥–µ–Ω–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ");

    console.log("‚úÖ –¢–ï–°–¢ –ü–†–û–ô–î–ï–ù: –ü–µ—Ä–µ—Ö–æ–¥ –≤ —Ä–∞–∑–¥–µ–ª –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ!");
  });

  /**
   * TEST #4: –ë–∞–∑–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç–∏ (viewport)
   *
   * –î–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è—Ö
   */
  test("–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ –º–æ–±–∏–ª—å–Ω–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ", async ({ page }) => {
    const sandboxPage = new QASandboxPage(page);

    console.log("üöÄ –ù–∞—á–∏–Ω–∞—é —Ç–µ—Å—Ç: –ú–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è");

    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –º–æ–±–∏–ª—å–Ω—ã–π viewport (iPhone 13)
    await page.setViewportSize({ width: 390, height: 844 });
    console.log("üì± –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω viewport –º–æ–±–∏–ª—å–Ω–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (390x844)");

    await sandboxPage.goto();

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∑–∏–ª–∞—Å—å
    const isLoaded = await sandboxPage.isLoaded();
    expect(isLoaded).toBe(true);
    console.log("‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∑–∏–ª–∞—Å—å –Ω–∞ –º–æ–±–∏–ª—å–Ω–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ");

    // –î–µ–ª–∞–µ–º —Å–∫—Ä–∏–Ω—à–æ—Ç –º–æ–±–∏–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏
    await page.screenshot({
      path: "test-results/qa-sandbox-mobile.png",
      fullPage: true,
    });
    console.log("üì∏ –°–∫—Ä–∏–Ω—à–æ—Ç –º–æ–±–∏–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏ —Å–æ—Ö—Ä–∞–Ω—ë–Ω");

    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º desktop viewport
    await page.setViewportSize({ width: 1280, height: 720 });

    console.log("‚úÖ –¢–ï–°–¢ –ü–†–û–ô–î–ï–ù: –ú–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç!");
  });

  /**
   * TEST #5: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∑–∞–≥—Ä—É–∑–∫–∏
   */
  test("–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã", async ({ page }) => {
    console.log("üöÄ –ù–∞—á–∏–Ω–∞—é —Ç–µ—Å—Ç: –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å");

    const startTime = Date.now();

    // –ò—Å–ø–æ–ª—å–∑—É–µ–º baseURL –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞ (/)
    await page.goto("/");
    await page.waitForLoadState("networkidle");

    const loadTime = Date.now() - startTime;

    console.log(`‚è±Ô∏è –í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã: ${loadTime}ms`);

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∑–∏–ª–∞—Å—å –±—ã—Å—Ç—Ä–µ–µ 5 —Å–µ–∫—É–Ω–¥
    expect(loadTime).toBeLessThan(5000);

    console.log("‚úÖ –¢–ï–°–¢ –ü–†–û–ô–î–ï–ù: –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –±—ã—Å—Ç—Ä–æ!");
  });
});

/**
 * üìö –ü–û–õ–ï–ó–ù–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø:
 *
 * 1. –ó–ê–ü–£–°–ö –¢–ï–°–¢–û–í:
 *    npm test                               - –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã
 *    npm test qa-sandbox.spec.ts            - –∑–∞–ø—É—Å—Ç–∏—Ç—å —ç—Ç–æ—Ç —Ñ–∞–π–ª
 *    npm run test:headed                    - —Å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –±—Ä–∞—É–∑–µ—Ä–∞
 *    npm run test:debug                     - –≤ —Ä–µ–∂–∏–º–µ –æ—Ç–ª–∞–¥–∫–∏
 *    npm run test:ui                        - –≤ UI Mode (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø!)
 *
 * 2. –û–¢–ß–Å–¢–´:
 *    npm run report                         - –æ—Ç–∫—Ä—ã—Ç—å HTML –æ—Ç—á—ë—Ç
 *
 * 3. CODEGEN (–¥–ª—è –∏–∑—É—á–µ–Ω–∏—è –Ω–æ–≤—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü):
 *    npm run codegen                        - –∑–∞–ø–∏—Å–∞—Ç—å –¥–µ–π—Å—Ç–≤–∏—è –≤ –∫–æ–¥
 *
 * 4. –ü–û–õ–ï–ó–ù–´–ï –°–°–´–õ–ö–ò:
 *    - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Playwright: https://playwright.dev
 *    - QA Sandbox: https://testingit.ru/
 */
